// Generated by CoffeeScript 1.6.2
var CozyInstance, americano, resetKey;

americano = require('americano-cozy');

module.exports = CozyInstance = americano.getModel('CozyInstance', {
  id: {
    type: String
  },
  domain: {
    type: String
  },
  locale: {
    type: String
  }
});

CozyInstance.first = function(callback) {
  return CozyInstance.request('all', function(err, instances) {
    if (err) {
      return callback(err);
    } else if (!instances || instances.length === 0) {
      return callback(null, null);
    } else {
      return callback(null, instances[0]);
    }
  });
};

CozyInstance.getLocale = function(callback) {
  return CozyInstance.first(function(err, instance) {
    return callback(err, (instance != null ? instance.locale : void 0) || null);
  });
};

CozyInstance.createOrUpdate = function(instanceData, callback) {
  return CozyInstance.first(function(err, instance) {
    if (err != null) {
      return callback(err);
    } else if (instance != null) {
      return instance.updateAttributes(instanceData, callback);
    } else {
      return CozyInstance.create(instanceData, callback);
    }
  });
};

resetKey = null;

CozyInstance.getResetKey = function() {
  return resetKey;
};

CozyInstance.setResetKey = function(key) {
  resetKey = key;
  return setTimeout(function() {
    return resetKey = null;
  }, 1 * 60 * 60 * 1000);
};
