// Generated by CoffeeScript 1.9.3
var americano, authSteps, config, cookieParser, cookieSession, fs, passport, path, randomstring, selectiveBodyParser, useBuildView, usetracker;

fs = require('fs');

path = require('path');

americano = require('americano');

cookieParser = require('cookie-parser');

cookieSession = require('cookie-session');

passport = require('passport');

randomstring = require('randomstring');

usetracker = require('./middlewares/usetracker');

selectiveBodyParser = require('./middlewares/selective_body_parser');

authSteps = [
  cookieParser(randomstring.generate()), cookieSession({
    secret: randomstring.generate(),
    maxage: 1000 * 60 * 60 * 24 * 7,
    secureProxy: process.env.NODE_ENV === 'production'
  }), passport.initialize(), passport.session()
];

useBuildView = fs.existsSync(path.resolve(__dirname, 'views/index.js'));

config = {
  authSteps: authSteps,
  supportedLanguages: ['en', 'fr'],
  common: {
    use: [
      americano.errorHandler({
        dumpExceptions: true,
        showStack: true
      }), americano["static"](path.join(__dirname, '/../client/public')), selectiveBodyParser, usetracker, authSteps[0], authSteps[1], authSteps[2], authSteps[3]
    ],
    set: {
      'view engine': useBuildView ? 'js' : 'jade',
      'views': path.resolve(__dirname, 'views')
    },
    engine: {
      js: function(path, locales, callback) {
        return callback(null, require(path)(locales));
      }
    }
  },
  development: [americano.logger('dev')],
  production: [americano.logger('short')],
  plugins: ['americano-cozy']
};

module.exports = config;
