webpackJsonp([1],{83:function(t,e,n){var s,i,r,o,p=function(t,e){return function(){return t.apply(e,arguments)}},u=function(t,e){function n(){this.constructor=t}for(var s in e)a.call(e,s)&&(t[s]=e[s]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},a={}.hasOwnProperty,l=[].indexOf||function(t){for(var e=0,n=this.length;e<n;e++)if(e in this&&this[e]===t)return e;return-1};i=n(7),s=n(9),o=n(30),t.exports=r=function(t){function e(){return this.signupSubmit=p(this.signupSubmit,this),e.__super__.constructor.apply(this,arguments)}return u(e,t),e.prototype.steps=function(){var t;return t=l.call(window.ENV.apps,"import-from-google")>=0,{preset:{next:t?"import":"setup",nextLabel:"sign up"},"import":{next:"setup",nextLabel:"skip"},import_google:{nocontrols:!0},setup:{next:"welcome",nocontrols:!0},welcome:{nextLabel:"welcome"}}}(),e.prototype.initialize=function(){return this.errors=new i.Bus,this.initStep(),this.initControls(),this.initSignup(),this.initSetEmail()},e.prototype.setStep=function(t){return this.setStepBus.push(t)},e.prototype.initStep=function(){var t;return this.setStepBus=new i.Bus,this.stepValve=new i.Bus,t=this.setStepBus.holdWhen(this.stepValve.startWith(!1).toProperty()).filter(function(t){return function(e){return l.call(Object.keys(t.steps),e)>=0}}(this)).toProperty(null),this.add("step",t),this.add("nextStep",t.map(function(t){return function(e){var n;return(null!=(n=t.steps[e])?n.next:void 0)||null}}(this)))},e.prototype.initControls=function(){var t;return this.nextEnabled=new i.Bus,this.nextBusy=new i.Bus,this.nextLabel=new i.Bus,t=i.combineTemplate({enabled:this.nextEnabled.startWith(!0).toProperty(),busy:this.nextBusy.startWith(!1).toProperty(),label:this.nextLabel.startWith("next").toProperty(),visible:this.get("step").map(function(t){return function(e){var n;return!(null!=(n=t.steps[e])?n.nocontrols:void 0)}}(this))}),this.nextLabel.plug(this.get("step").map(function(t){return function(e){var n;return null!=(n=t.steps[e])?n.nextLabel:void 0}}(this))),this.setStepBus.filter(function(t){return function(e){return!(l.call(Object.keys(t.steps),e)>=0)}}(this)).onValue(function(t){var e;return e=window.location,window.location.href=e.protocol+"//"+e.host+t}),this.add("nextControl",t)},e.prototype.initSignup=function(){return this.signup=new i.Bus,this.stepValve.plug(this.get("step").map(function(t){return"preset"===t})),this.nextEnabled.plug(this.get("step").map(function(t){return"preset"!==t})),this.signup.onValue(this.signupSubmit)},e.prototype.signupSubmit=function(t){var e;return e=i.fromPromise(s.post("/register",JSON.stringify(t))),e.subscribe(function(){return window.username=t.public_name}),this.stepValve.plug(e.map(!1)),this.errors.plug(e.errors().mapError(".responseJSON.errors")),this.nextBusy.plug(e.mapEnd(!1))},e.prototype.initSetEmail=function(){return this.setEmail=new i.Bus,this.setEmail.onValue(this.setEmailSubmit)},e.prototype.setEmailSubmit=function(t){var e,n;return n=t["imap-login"]||t.email,e={id:null,label:t.email,name:t.email.split("@")[0],login:n,password:t.password,accountType:"IMAP",draftMailbox:"",favoriteMailboxes:null,imapPort:t["imap-port"],imapSSL:t["imap-ssl"],imapServer:t["imap-server"],imapTLS:!1,smtpLogin:t["smtp-login"]||n,smtpMethod:"PLAIN",smtpPassword:t["smtp-password"]||t.password,smtpPort:t["smtp-port"],smtpSSL:t["smtp-ssl"],smtpServer:t["smtp-server"]||t["imap-server"],smtpTLS:!1,mailboxes:"",sentMailbox:"",trashMailbox:""},s.ajax({type:"POST",url:"/apps/emails/account",data:JSON.stringify(e),contentType:"application/json; charset=utf-8",dataType:"json"})},e}(o)}});
//# sourceMappingURL=register.471a3aa41f3e720ebae0.js.map